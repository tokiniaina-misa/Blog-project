{% extends 'accounts/base_auth.html' %}
{% block title %}Accueil{% endblock %}
{% block content %}
{% if messages %}
  <div class="max-w-xl mx-auto my-4">
    {% for message in messages %}
      <div class="p-4 mb-2 rounded text-white {{ message.tags|default:'bg-red-600' }}">
        {{ message }}
      </div>
    {% endfor %}
  </div>
{% endif %}
<div class="flex flex-col lg:flex-row gap-8">
    <!-- Main article -->
    <div class="flex-1">
        <div class="bg-white rounded shadow p-6 mb-8">
            {% if featured_post %}
                <img src="{{ featured_post.image.url }}" class="w-full h-64 object-cover rounded mb-4" alt="Featured">
                <h2 class="text-3xl font-bold mb-2">{{ featured_post.title }}</h2>
                <div class="text-gray-500 mb-2">By {{ featured_post.author.username }} on {{ featured_post.created_at|date:"F d, Y" }}</div>
                <p class="mb-4 text-gray-700">{{ featured_post.content|truncatewords:30 }}</p>
                <a href="{% url 'blog:post_detail' featured_post.id %}" class="inline-block px-4 py-2 border border-blue-600 text-blue-600 rounded hover:bg-blue-600 hover:text-white transition">Read More</a>
            {% else %}
                <h2 class="text-2xl font-bold mb-2">No featured post</h2>
            {% endif %}
        </div>
        {% if user.is_authenticated and user.profile.is_author %}
        <div class="flex justify-center mb-8">
            <button id="publish-btn" class="bg-blue-600 text-white font-bold px-8 py-3 rounded-lg shadow-lg animate-pulse relative overflow-hidden" style="font-size:1.3rem;">
                Publier
                <span id="particles" class="absolute inset-0 pointer-events-none"></span>
            </button>
        </div>
        <script>
        // Animation particules pixel
        document.getElementById('publish-btn').onclick = function(e) {
            e.preventDefault();
            var btn = this;
            var particles = document.getElementById('particles');
            particles.innerHTML = '';
            for (let i = 0; i < 40; i++) {
                let p = document.createElement('span');
                p.style.position = 'absolute';
                p.style.width = '6px';
                p.style.height = '6px';
                p.style.background = '#3b82f6';
                p.style.borderRadius = '2px';
                p.style.left = (btn.offsetWidth/2 + (Math.random()-0.5)*40) + 'px';
                p.style.top = (btn.offsetHeight/2 + (Math.random()-0.5)*20) + 'px';
                p.style.opacity = 1;
                p.style.transition = 'all 0.7s cubic-bezier(.17,.67,.83,.67)';
                particles.appendChild(p);
                setTimeout(() => {
                    p.style.transform = `translate(${(Math.random()-0.5)*120}px, ${(Math.random()-0.5)*80}px)`;
                    p.style.opacity = 0;
                }, 10);
                setTimeout(() => p.remove(), 800);
            }
            setTimeout(function(){ window.location.href = "{% url 'blog:post_create' %}"; }, 700);
        };
        </script>
        {% endif %}
        <!-- Articles grid -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
            {% for post in page_obj %}
                <div class="group bg-white/60 backdrop-blur-lg rounded-2xl shadow-lg p-0 flex flex-col transition-all duration-300 hover:scale-105 hover:z-10 hover:bg-white/80 hover:shadow-2xl relative overflow-hidden" style="border: 1px solid rgba(255,255,255,0.2);">
                    {% if post.image %}
                        <div class="w-full h-40 flex items-center justify-center overflow-hidden rounded-t-2xl mb-0">
                            <img src="{{ post.image.url }}" class="object-cover w-full h-full" style="max-width:100%;max-height:100%;" alt="Post image">
                        </div>
                    {% endif %}
                    <div class="p-4 flex-1 flex flex-col">
                        <h3 class="font-bold text-lg mb-1">{{ post.title }}</h3>
                        <div class="text-gray-500 text-sm mb-1">By {{ post.author.username }} on {{ post.created_at|date:"F d, Y" }}</div>
                        <p class="text-gray-700 mb-2 transition-all duration-300 group-hover:text-lg group-hover:text-gray-900 group-hover:font-semibold group-hover:bg-white/40 group-hover:backdrop-blur-md group-hover:p-2 group-hover:rounded-xl">{{ post.content|truncatewords:15 }}</p>
                        <a href="{% url 'blog:post_detail' post.id %}" class="text-blue-600 hover:underline mt-auto">Read More</a>
                    </div>
                    <div class="absolute inset-0 pointer-events-none transition-all duration-300 group-hover:bg-white/30 group-hover:backdrop-blur-xl rounded-2xl"></div>
                </div>
            {% endfor %}
        </div>
    </div>
    <!-- Sidebar -->
    <aside class="w-full lg:w-80 flex-shrink-0">
        <div class="bg-white rounded shadow p-6 mb-6">
            <h4 class="font-bold mb-4">Trending</h4>
            <ul>
                {% for trend in trending %}
                    <li class="mb-2 flex items-center">
                        {% with color_class="bg-blue-500" %}
                          {% if trend.color and trend.color in allowed_colors %}
                            {% with color_class="bg-"|add:trend.color|add:"-500" %}{% endwith %}
                          {% endif %}
                          <span class="inline-block w-2 h-2 rounded-full mr-2 {{ color_class }}"></span>
                        {% endwith %}
                        {{ trend.title }}
                    </li>
                {% endfor %}
            </ul>
        </div>
        <div class="bg-white rounded shadow p-6 mb-6">
            <h4 class="font-bold mb-4">Topics</h4>
            <div class="flex flex-wrap gap-2">
                {% for topic in topics %}
                    <span class="px-3 py-1 rounded bg-blue-100 text-blue-700 text-xs">{{ topic }}</span>
                {% endfor %}
            </div>
        </div>
        <div class="bg-white rounded shadow p-6">
            <h4 class="font-bold mb-4">Tagging</h4>
            <p class="text-gray-600 text-sm">A senliibrar of mastel<br>fored.iv.soy|kmive</p>
        </div>
    </aside>
</div>
{% endblock %}
